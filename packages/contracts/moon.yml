# yaml-language-server: $schema=../../.moon/cache/schemas/project.json

layer: library

fileGroups:
  sources:
    - src/**/*
    - rollup.config.mjs
    - package.json
    - tsconfig.*
    - eslint.config.mjs
  test:
    - tests/**/*
    - vitest.config.ts

tasks:
  build:
    command: rollup -c rollup.config.mjs
    inputs:
      - "@group(sources)"
    outputs:
      - dist/
  build-tsc:
    command: tsc --project tsconfig.tsc.json
    inputs:
      - "@group(sources)"
    outputs:
      - output/
  docs: 
    command: typedoc src/indexpool.ts --out @out(0)
    deps: [build]
    inputs:
      - "@group(sources)"
    outputs:
      - docs/
  typecheck:
    command: tsc --noEmit --project tsconfig.tsc.json
    inputs:
      - "@group(sources)"
      - "@group(test)"
  lint:
    command: eslint src/* tests/*
    inputs:
      - "@group(sources)"
      - "@group(test)"
  lint-fix:
    extends: lint
    args: --fix
  test: 
    command: vitest run --testTimeout=150000
    inputs:
      - "@group(sources)"
      - "@group(test)"
  test-watch:
    command: vitest watch
    preset: "watcher"
    inputs:
      - "@group(sources)"
      - "@group(test)"
  test-coverage:
    extends: test
    args: --coverage
  test-factory:
    extends: test
    args: Factory
  test-faucet:
    extends: test
    args: Faucet
  test-data:
    extends: test
    args: PoolData
  test-token:
    extends: test
    args: PoolToken
  test-multisig:
    extends: test
    args: MultiSig