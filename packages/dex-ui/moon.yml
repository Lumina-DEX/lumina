# yaml-language-server: $schema=../../.moon/cache/schemas/project.json

layer: application

dependsOn:
  - sdk

fileGroups:
  sources:
    - src/**/*
    - public/**/*
    - "*.d.ts"
    - tailwind.config.js
    - postcss.config.mjs
    - next.config.mjs
    - open-next.config.ts
    - package.json
    - tsconfig.json

tasks:
  build:
    description: This needs a build script in package.json.
    command: opennextjs-cloudflare build
    deps: [^:build]
    inputs:
      - "@group(sources)"
    outputs:
      - .open-next/
  type-cf:
    command: wrangler types
    inputs:
      - wrangler.jsonc
    outputs:
      - worker-configuration.d.ts
  typecheck:
    command: tsc --noEmit
    deps: [^:build]
    inputs:
      - "@group(sources)"
  typewatch:
    extends: typecheck
    args: [--incremental, --watch]
    preset: "watcher"
  lint:
    command: oxlint
    args: [src/]
    inputs:
      - "@group(sources)"
  lint-fix:
    command: oxlint
    args: [--fix, src/]
    inputs:
      - "@group(sources)"
  dev:
    command: next dev
    deps: [^:build]
    preset: "server"
  preview:
    command: opennextjs-cloudflare preview
    deps: [build]
    preset: "server"
  deploy:
    command: opennextjs-cloudflare deploy
    deps: [build]
  deploy-preview:
    command: opennextjs-cloudflare upload
    deps: [build]
